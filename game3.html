<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤©ä¸‹å¤ªå¹³ - é£›æ©Ÿå¤§ç ²éŠæˆ²</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
}
body {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
padding: 20px;
color: #333;
}
.game-container {
background: rgba(255, 255, 255, 0.9);
border-radius: 20px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
padding: 30px;
max-width: 900px;
width: 100%;
margin: 20px;
}
h1 {
text-align: center;
color: #e74c3c;
margin-bottom: 20px;
font-size: 2.5em;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.game-info {
background: #f8f9fa;
border-left: 4px solid #3498db;
padding: 15px;
margin: 15px 0;
border-radius: 0 10px 10px 0;
}
/* æ–°å¢ï¼šæ§åˆ¶å€åŸŸæ¨£å¼ */
.controls-area {
    background: #fff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin: 20px 0;
    text-align: center;
}
.players-container {
display: flex;
justify-content: space-between;
flex-wrap: wrap;
gap: 20px;
margin: 20px 0;
}
.player-panel {
flex: 1;
min-width: 300px;
background: #3498db;
border-radius: 15px;
padding: 20px;
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
color: white;
position: relative;
overflow: hidden;
}
.player-panel.player2 {
background: #e74c3c;
}
.player-title {
text-align: center;
font-size: 1.8em;
margin-bottom: 15px;
font-weight: bold;
text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.fortress {
display: grid;
grid-template-columns: repeat(2, 1fr);
grid-template-rows: repeat(2, 1fr);
gap: 10px;
margin: 15px 0;
}
.fortress-cell {
background: rgba(255, 255, 255, 0.2);
border: 2px solid white;
border-radius: 8px;
display: flex;
justify-content: center;
align-items: center;
font-size: 1.5em;
font-weight: bold;
height: 60px;
min-height: 60px;
}
.player-panel.player2 .fortress-cell {
background: rgba(255, 255, 255, 0.1);
}
.facilities {
margin: 15px 0;
}
.facility-item {
display: flex;
justify-content: space-between;
margin: 8px 0;
padding: 8px;
background: rgba(255, 255, 255, 0.15);
border-radius: 8px;
}
.rock-paper-scissors {
display: flex;
justify-content: center;
gap: 15px;
margin: 25px 0;
}
.rps-btn {
width: 80px;
height: 80px;
border-radius: 50%;
border: none;
background: white;
font-size: 1.2em;
font-weight: bold;
cursor: pointer;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
transition: all 0.3s ease;
}
.rps-btn:hover {
transform: scale(1.1);
box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}
.rps-btn.rock { background: #ff9999; }
.rps-btn.paper { background: #99ff99; }
.rps-btn.scissors { background: #9999ff; }
.game-controls {
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 10px;
margin: 20px 0;
}

.action-btn {
padding: 12px 18px;
border: none;
border-radius: 25px;
font-size: 0.9em;
font-weight: bold;
cursor: pointer;
transition: all 0.3s ease;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
min-width: 120px;
}
.action-btn {
padding: 12px 24px;
border: none;
border-radius: 25px;
font-size: 1em;
font-weight: bold;
cursor: pointer;
transition: all 0.3s ease;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.build-btn {
background: #2ecc71;
color: white;
}
.attack-btn {
background: #e74c3c;
color: white;
}
.repair-btn {
background: #3498db;
color: white;
}
.action-btn:hover {
transform: translateY(-2px);
box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}
.game-status {
text-align: center;
font-size: 1.5em;
margin: 20px 0;
padding: 15px;
background: #f1c40f;
border-radius: 10px;
font-weight: bold;
color: #2c3e50;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.result-display {
text-align: center;
font-size: 2.5em;
margin: 20px 0;
font-weight: bold;
color: #e74c3c;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
min-height: 60px;
}
.hidden {
display: none;
}
.phase-indicator {
text-align: center;
font-size: 1.2em;
margin: 10px 0;
padding: 8px;
background: rgba(255, 255, 255, 0.2);
border-radius: 8px;
font-weight: bold;
}
.phase-indicator.attack-ready {
background: rgba(255, 215, 0, 0.3);
border: 1px solid #ffc107;
}
.facility-highlight {
animation: pulse 1.5s infinite;
}
@keyframes pulse {
0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
}
@media (max-width: 768px) {
.players-container {
flex-direction: column;
}
.player-panel {
min-width: 100%;
}
.rock-paper-scissors {
flex-direction: column;
align-items: center;
}
.rps-btn {
width: 80px;
height: 80px;
margin: 8px 0;
font-size: 2rem;
min-height: 80px; 
min-width: 80px;
}
.action-btn {
min-height: 50px;
min-width: 120px;
font-size: 16px;
margin: 8px;
padding: 15px 25px;
}
.fortress-cell {
height: 70px;
font-size: 1.8rem;
min-height: 70px;
}
h1 {
font-size: 2em;
}
body {
touch-action: manipulation;
-ms-touch-action: manipulation;
}
}
/* æ¨¡æ…‹æ¡†æ¨£å¼ */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.7);
display: none;
justify-content: center;
align-items: center;
z-index: 1000;
}
.modal-content {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 20px;
padding: 30px;
max-width: 400px;
width: 90%;
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
animation: modalSlideIn 0.3s ease-out;
}
@keyframes modalSlideIn {
from {
transform: translateY(-50px);
opacity: 0;
}
to {
transform: translateY(0);
opacity: 1;
}
}
.modal-title {
color: white;
font-size: 1.5rem;
margin-bottom: 20px;
text-align: center;
font-weight: bold;
}
.modal-options {
display: flex;
flex-direction: column;
gap: 12px;
}
.modal-option {
background: rgba(255, 255, 255, 0.9);
border: none;
border-radius: 15px;
padding: 15px 20px;
font-size: 1rem;
font-weight: bold;
cursor: pointer;
transition: all 0.3s ease;
color: #333;
text-align: left;
}
.modal-option:hover {
background: rgba(255, 255, 255, 1);
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}
.modal-option:active {
transform: translateY(0);
}
.modal-cancel {
background: rgba(231, 76, 60, 0.9);
color: white;
margin-top: 10px;
}
.modal-cancel:hover {
background: rgba(231, 76, 60, 1);
}
/* è§¸æ§è¨­å‚™å°ˆç”¨æ¨£å¼ */
@media (hover: none) and (pointer: coarse) {
.action-btn:active {
transform: scale(0.95);
}
.rps-btn:active {
transform: scale(0.9);
box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.fortress-cell:active {
transform: scale(0.95);
background: rgba(255, 255, 255, 0.3);
}
.modal-option:active {
transform: scale(0.95);
}
* {
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
-webkit-touch-callout: none;
}
}
/* æ–°å¢ï¼šæ¨¡å¼é¸æ“‡æŒ‰éˆ• */
.mode-select-container {
    text-align: center;
    margin: 20px 0;
}
.mode-btn {
    padding: 15px 30px;
    margin: 0 10px;
    font-size: 1.2em;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    color: white;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}
.mode-btn.ai { background: #9b59b6; }
.mode-btn.friend { background: #1abc9c; }
.mode-btn:hover { transform: scale(1.05); }
</style>
</head>
<body>
<div class="game-container">
<h1>ğŸ® å¤©ä¸‹å¤ªå¹³ - é£›æ©Ÿå¤§ç ² ğŸ®</h1>

<!-- éŠæˆ²é–‹å§‹æŒ‰éˆ• -->
<div class="mode-select-container" id="modeSelect">
    <p style="margin-bottom: 15px; font-size: 1.2em; color: #333;">æº–å‚™é–‹å§‹éŠæˆ²ï¼š</p>
    <button class="mode-btn ai" onclick="startGame()">ğŸ¤– é–‹å§‹éŠæˆ² (VS é›»è…¦)</button>
</div>

<div class="game-info">
<p><strong>ğŸ® éŠæˆ²ç©æ³•èªªæ˜ï¼š</strong></p>
<p>1ï¸âƒ£ <strong>çŒœæ‹³æ±ºå®šè¡Œå‹•æ¬Š</strong>ï¼šè´çš„ä¸€æ–¹å¯ä»¥å»ºè¨­æˆ–æ”»æ“Š</p>
<p>2ï¸âƒ£ <strong>å»ºè¨­é †åº</strong>ï¼šå¿…é ˆå…ˆæ’ä¸€æ”¯æ—— â†’ ç„¶å¾Œå¯å»ºè¨­ä¿è­·ç½©æˆ–å¤§ç‚®</p>
<p>3ï¸âƒ£ <strong>æ”»æ“Šæ¢ä»¶</strong>ï¼šæ“æœ‰ <span style="color: #e74c3c; font-weight: bold;">1 æ—— +1 ç ²</span> å³å¯æ”»æ“Šï¼Œæ¯æ¬¡æ”»æ“Šæ‘§æ¯€å°æ‰‹ä¸€å€‹è¨­æ–½ï¼ˆä¿è­·ç½©ã€æ——å¹Ÿã€å¤§ç ²æˆ–å ¡å£˜ï¼‰</p>
<p>4ï¸âƒ£ <strong>ä¿®å¾©èˆ‡åæ“Š</strong>ï¼šè¢«æ”»æ“Šæ–¹è‹¥æƒ³ä¿®å¾©è¨­æ–½æˆ–åæ“Šï¼Œå¿…é ˆåœ¨ä¸‹ä¸€æ¬¡çŒœæ‹³å‹å‡º</p>
<p>5ï¸âƒ£ <strong>å‹åˆ©æ¢ä»¶</strong>ï¼šç•¶ä¸€æ–¹çš„æ——å¹Ÿã€ä¿è­·ç½©åŠå ¡å£˜æ–‡å­—å…¨è¢«æ“Šæ½°æ™‚ï¼Œå³è¼¸æ‰éŠæˆ²</p>
</div>

<!-- ç§»å‹•çŒœæ‹³å’Œæ§åˆ¶æŒ‰éˆ•åˆ°èªªæ˜ä¸‹æ–¹ -->
<div class="controls-area">
    <div class="game-status" id="gameStatus">è«‹é¸æ“‡éŠæˆ²æ¨¡å¼é–‹å§‹...</div>
    <div class="result-display" id="resultDisplay"></div>
    
    <div class="rock-paper-scissors" id="rpsContainer" style="display:none;">
        <button class="rps-btn rock" onclick="playerChoose('rock')">ğŸ‘Š çŸ³é ­</button>
        <button class="rps-btn paper" onclick="playerChoose('paper')">ğŸ–ï¸ å¸ƒ</button>
        <button class="rps-btn scissors" onclick="playerChoose('scissors')">âœŒï¸ å‰ªåˆ€</button>
    </div>
    
    <div class="game-controls" id="actionContainer" style="display:none;">
        <button class="action-btn build-btn" onclick="buildFlag()" id="buildFlagBtn">ğŸš© å»ºè¨­æ——å¹Ÿ</button>
        <button class="action-btn build-btn" onclick="buildCannon()" id="buildCannonBtn">ğŸ”« å»ºè¨­å¤§ç‚®</button>
        <button class="action-btn build-btn" onclick="buildShield()" id="buildShieldBtn">ğŸ›¡ï¸ å»ºè¨­ä¿è­·ç½©</button>
        <button class="action-btn attack-btn" onclick="attackEnemy()" id="attackBtn">âš”ï¸ æ”»æ“Šæ•µäºº</button>
    </div>
</div>

<div class="players-container">
<div class="player-panel player1">
<div class="player-title">ğŸ‘¨ ç©å®¶ 1</div>
<div class="phase-indicator" id="phase1">æº–å‚™éšæ®µ</div>
<div class="fortress" id="fortress1">
<div class="fortress-cell" id="cell1-1">å¤©</div>
<div class="fortress-cell" id="cell1-2">ä¸‹</div>
<div class="fortress-cell" id="cell1-3">å¤ª</div>
<div class="fortress-cell" id="cell1-4">å¹³</div>
</div>
<div class="facilities">
<div class="facility-item facility-highlight" id="flagsItem1">
<span>ğŸš© æ——å¹Ÿï¼š</span>
<span id="flags1">0/3</span>
</div>
<div class="facility-item" id="shieldsItem1">
<span>ğŸ›¡ï¸ ä¿è­·ç½©ï¼š</span>
<span id="shields1">0/5</span>
</div>
<div class="facility-item">
<span>ğŸ”« å¤§ç ²ï¼š</span>
<span id="cannons1">0</span>
</div>
</div>
</div>
<div class="player-panel player2">
<div class="player-title" id="player2Title">ğŸ¤– é›»è…¦</div>
<div class="phase-indicator" id="phase2">æº–å‚™éšæ®µ</div>
<div class="fortress" id="fortress2">
<div class="fortress-cell" id="cell2-1">å¤©</div>
<div class="fortress-cell" id="cell2-2">ä¸‹</div>
<div class="fortress-cell" id="cell2-3">å¤ª</div>
<div class="fortress-cell" id="cell2-4">å¹³</div>
</div>
<div class="facilities">
<div class="facility-item facility-highlight" id="flagsItem2">
<span>ğŸš© æ——å¹Ÿï¼š</span>
<span id="flags2">0/3</span>
</div>
<div class="facility-item" id="shieldsItem2">
<span>ğŸ›¡ï¸ ä¿è­·ç½©ï¼š</span>
<span id="shields2">0/5</span>
</div>
<div class="facility-item">
<span>ğŸ”« å¤§ç ²ï¼š</span>
<span id="cannons2">0</span>
</div>
</div>
</div>
</div>

<div style="text-align: center; margin-top: 20px;">
<button class="action-btn" style="background: #9b59b6; color: white;" onclick="resetGame()">ğŸ”„ é‡æ–°é–‹å§‹éŠæˆ²</button>
</div>
</div>
<script>
// éŠæˆ²ç‹€æ…‹
const gameState = {
currentPlayer: 1, // 1 = ç©å®¶ 1, 2 = ç©å®¶ 2/é›»è…¦
gameMode: 'ai', // 'ai' or 'friend'
rpsResult: null, // 'win', 'lose', 'draw'
lastChoice: null,
player1: {
flags: 0,
shields: 0,
cannons: 0,
fortressIntact: true,
},
player2: {
flags: 0,
shields: 0,
cannons: 0,
fortressIntact: true,
},
gameOver: false
};
// åˆå§‹åŒ–éŠæˆ²
function initGame() {
    // å®Œå…¨é‡ç½®éŠæˆ²ç‹€æ…‹
    gameState.currentPlayer = 1;
    gameState.gameMode = 'ai';
    gameState.rpsResult = null;
    gameState.lastChoice = null;
    gameState.gameOver = false;
    gameState.player1 = {
        flags: 0,
        shields: 0,
        cannons: 0,
        fortressIntact: true,
    };
    gameState.player2 = {
        flags: 0,
        shields: 0,
        cannons: 0,
        fortressIntact: true,
    };
    
    // é‡ç½®UI
    document.getElementById('modeSelect').style.display = 'block';
    document.getElementById('rpsContainer').style.display = 'none';
    document.getElementById('actionContainer').style.display = 'none';
    document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡éŠæˆ²æ¨¡å¼é–‹å§‹...';
    document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
    document.getElementById('resultDisplay').textContent = '';
    
    // é‡ç½®ç©å®¶2æ¨™é¡Œ
    document.getElementById('player2Title').textContent = 'ğŸ¤– é›»è…¦';
    
    // é‡ç½®å ¡å£˜æ–‡å­—
    resetFortressText(1);
    resetFortressText(2);
    
    // æ›´æ–°UI
    updateUI();
    
    // å•Ÿç”¨çŒœæ‹³æŒ‰éˆ•
    enableRPSButtons();
    disableActionButtons();
}

// é–‹å§‹éŠæˆ²
function startGame() {
    gameState.gameMode = 'ai';
    gameState.currentPlayer = 1;
    gameState.rpsResult = null;
    gameState.lastChoice = null;
    gameState.gameOver = false;
    gameState.player1 = {
        flags: 0,
        shields: 0,
        cannons: 0,
        fortressIntact: true,
    };
    gameState.player2 = {
        flags: 0,
        shields: 0,
        cannons: 0,
        fortressIntact: true,
    };
    
    // æ›´æ–° UI
    document.getElementById('modeSelect').style.display = 'none';
    document.getElementById('rpsContainer').style.display = 'flex';
    document.getElementById('actionContainer').style.display = 'flex';
    document.getElementById('resultDisplay').textContent = '';
    document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
    document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
    
    // æ›´æ–°ç©å®¶ 2 æ¨™é¡Œ
    document.getElementById('player2Title').textContent = 'ğŸ¤– é›»è…¦';
    
    // ç§»é™¤é«˜äº®æ•ˆæœ
    document.getElementById('flagsItem1').classList.remove('facility-highlight');
    document.getElementById('flagsItem2').classList.remove('facility-highlight');
    document.getElementById('shieldsItem1').classList.remove('facility-highlight');
    document.getElementById('shieldsItem2').classList.remove('facility-highlight');
    
    // é‡ç½®å ¡å£˜æ–‡å­—
    resetFortressText(1);
    resetFortressText(2);
    
    updateUI();
    enableRPSButtons();
    disableActionButtons();
}

function resetFortressText(playerId) {
    document.getElementById(`cell${playerId}-1`).textContent = 'å¤©';
    document.getElementById(`cell${playerId}-2`).textContent = 'ä¸‹';
    document.getElementById(`cell${playerId}-3`).textContent = 'å¤ª';
    document.getElementById(`cell${playerId}-4`).textContent = 'å¹³';
}

// ç©å®¶é¸æ“‡çŒœæ‹³
function playerChoose(choice) {
if (gameState.gameOver) return;
gameState.lastChoice = choice;
const computerChoice = getComputerChoice();
// é¡¯ç¤ºé¸æ“‡çµæœ
document.getElementById('gameStatus').textContent =
`ç©å®¶ 1 å‡º ${getChoiceName(choice)}ï¼Œé›»è…¦å‡º ${getChoiceName(computerChoice)}`;
// è¨ˆç®—çµæœ
gameState.rpsResult = calculateRPSResult(choice, computerChoice);
if (gameState.rpsResult === 'win') {
document.getElementById('gameStatus').textContent += ' - ç©å®¶ 1 è´äº†ï¼å¯ä»¥è¡Œå‹•ï¼';
document.getElementById('gameStatus').style.backgroundColor = '#2ecc71';
gameState.currentPlayer = 1;
} else if (gameState.rpsResult === 'lose') {
document.getElementById('gameStatus').textContent += ' - ç©å®¶ 1 è¼¸äº†ï¼é›»è…¦è¡Œå‹•ï¼';
document.getElementById('gameStatus').style.backgroundColor = '#e74c3c';
gameState.currentPlayer = 2;
} else {
document.getElementById('gameStatus').textContent += ' - å¹³æ‰‹ï¼å†ä¾†ä¸€æ¬¡ï¼';
document.getElementById('gameStatus').style.backgroundColor = '#f39c12';
enableRPSButtons();
disableActionButtons();
return;
}
disableRPSButtons();
enableActionButtons();
// å¦‚æœæ˜¯é›»è…¦è¡Œå‹•ï¼Œè‡ªå‹•åŸ·è¡Œ
if (gameState.currentPlayer === 2) {
setTimeout(computerAction, 1000);
}
}

// é›»è…¦é¸æ“‡çŒœæ‹³
function getComputerChoice() {
const choices = ['rock', 'paper', 'scissors'];
return choices[Math.floor(Math.random() * 3)];
}

// è¨ˆç®—çŒœæ‹³çµæœ
function calculateRPSResult(playerChoice, computerChoice) {
if (playerChoice === computerChoice) {
return 'draw';
}
if (
(playerChoice === 'rock' && computerChoice === 'scissors') ||
(playerChoice === 'paper' && computerChoice === 'rock') ||
(playerChoice === 'scissors' && computerChoice === 'paper')
) {
return 'win';
}
return 'lose';
}

// ç²å–é¸æ“‡çš„ä¸­æ–‡åç¨±
function getChoiceName(choice) {
const names = {
'rock': 'çŸ³é ­',
'paper': 'å¸ƒ',
'scissors': 'å‰ªåˆ€'
};
return names[choice];
}

// é›»è…¦è‡ªå‹•è¡Œå‹•
function computerAction() {
if (gameState.gameOver) return;
const player = gameState.player2;
let actionTaken = false;

// æ–°è¦å‰‡é‚è¼¯ï¼š
// 1. å¦‚æœæ²’æœ‰æ——ï¼Œå…ˆæ’æ——
// 2. å¦‚æœæœ‰æ——ä½†æ²’æœ‰ç ²ï¼Œå»ºç ²
// 3. å¦‚æœæœ‰æ——æœ‰ç ²ï¼Œå¯ä»¥æ”»æ“Šæˆ–å»ºä¿è­·ç½©
// 4. ä¿è­·ç½©æœªæ»¿å¯å»ºä¿è­·ç½©

if (player.flags === 0) {
    player.flags++;
    document.getElementById('gameStatus').textContent = 'é›»è…¦æ’äº†ä¸€ææ——ï¼';
    actionTaken = true;
} else if (player.cannons === 0) {
    player.cannons++;
    document.getElementById('gameStatus').textContent = 'é›»è…¦å»ºé€ äº†å¤§ç ²ï¼';
    actionTaken = true;
} else if (canAttackComputer()) {
    // æœ‰æ——æœ‰ç ²ï¼Œå„ªå…ˆæ”»æ“Š
    computerAttack();
    actionTaken = true;
} else if (player.shields < 5) {
    player.shields++;
    document.getElementById('gameStatus').textContent = 'é›»è…¦å»ºäº†ä¸€å±¤ä¿è­·ç½©ï¼';
    actionTaken = true;
} else {
    // æ»¿äº†ï¼Œéš¨æ©Ÿå»ºæ——æˆ–ç ²
    if (player.flags < 3) {
        player.flags++;
        document.getElementById('gameStatus').textContent = 'é›»è…¦æ’äº†ä¸€ææ——ï¼';
    } else {
        player.cannons++;
        document.getElementById('gameStatus').textContent = 'é›»è…¦å»ºé€ äº†å¤§ç ²ï¼';
    }
    actionTaken = true;
}

if (actionTaken) {
    updateUI();
    checkGameOver();
}

setTimeout(() => {
if (!gameState.gameOver) {
document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
enableRPSButtons();
disableActionButtons();
}
}, 1500);
}

// é›»è…¦æ˜¯å¦å¯ä»¥æ”»æ“Š
function canAttackComputer() {
    const player = gameState.player2;
    return player.flags >= 1 && player.cannons >= 1;
}

// é›»è…¦æ”»æ“Š
function computerAttack() {
const player1 = gameState.player1;
// æ–°è¦å‰‡ï¼šæ¯æ¬¡æ”»æ“Šæ‘§æ¯€ä¸€å€‹è¨­æ–½
// å„ªå…ˆé †åºï¼šä¿è­·ç½© > æ——å¹Ÿ > å¤§ç ² (å¦‚æœæœ‰) > å ¡å£˜
let target = '';
if (player1.shields > 0) {
target = 'shields';
} else if (player1.flags > 0) {
target = 'flags';
} else if (player1.cannons > 0) {
    target = 'cannons';
} else if (player1.fortressIntact) {
target = 'fortress';
}

if (!target) return; 

if (target === 'shields') {
player1.shields--;
document.getElementById('gameStatus').textContent = `é›»è…¦æ”»æ“Šäº†ä½ çš„ä¿è­·ç½©ï¼æ‘§æ¯€äº† 1 å±¤ï¼å‰©é¤˜${player1.shields}å±¤ï¼`;
} else if (target === 'flags') {
player1.flags--;
document.getElementById('gameStatus').textContent = `é›»è…¦æ”»æ“Šäº†ä½ çš„æ——å¹Ÿï¼æ‘§æ¯€äº† 1 æï¼å‰©é¤˜${player1.flags}æï¼`;
} else if (target === 'cannons') {
    player1.cannons--;
    document.getElementById('gameStatus').textContent = `é›»è…¦æ”»æ“Šäº†ä½ çš„å¤§ç ²ï¼æ‘§æ¯€äº† 1 é–€ï¼å‰©é¤˜${player1.cannons}é–€ï¼`;
} else if (target === 'fortress') {
player1.fortressIntact = false;
document.getElementById('cell1-1').textContent = 'âŒ';
document.getElementById('cell1-2').textContent = 'âŒ';
document.getElementById('cell1-3').textContent = 'âŒ';
document.getElementById('cell1-4').textContent = 'âŒ';
document.getElementById('gameStatus').textContent = 'é›»è…¦æ‘§æ¯€äº†ä½ çš„å ¡å£˜ï¼';
}
}

// ç©å®¶å»ºè¨­æ——å¹Ÿ
function buildFlag() {
if (gameState.currentPlayer !== 1 || gameState.gameOver) return;

const player = gameState.player1;
let actionText = '';

// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­æ——å¹Ÿ
if (player.flags < 3) {
    player.flags++;
    actionText = 'ä½ æ’äº†ä¸€ææ——ï¼';
} else {
    actionText = 'æ——å¹Ÿå·²é”ä¸Šé™ (3æ)ï¼';
}

document.getElementById('gameStatus').textContent = actionText;
updateUI();
resetTurn();
}

// ç©å®¶å»ºè¨­å¤§ç‚®
function buildCannon() {
if (gameState.currentPlayer !== 1 || gameState.gameOver) return;

const player = gameState.player1;
let actionText = '';

// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­å¤§ç‚®ï¼ˆéœ€è¦æœ‰æ——å¹Ÿï¼‰
if (player.flags === 0) {
    actionText = 'éœ€è¦å…ˆæ’ä¸€æ”¯æ——æ‰èƒ½å»ºè¨­å¤§ç‚®ï¼';
} else {
    player.cannons++;
    actionText = 'ä½ å»ºé€ äº†å¤§ç ²ï¼';
}

document.getElementById('gameStatus').textContent = actionText;
updateUI();
resetTurn();
}

// ç©å®¶å»ºè¨­ä¿è­·ç½©
function buildShield() {
if (gameState.currentPlayer !== 1 || gameState.gameOver) return;

const player = gameState.player1;
let actionText = '';

// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­ä¿è­·ç½©ï¼ˆéœ€è¦æœ‰æ——å¹Ÿï¼‰
if (player.flags === 0) {
    actionText = 'éœ€è¦å…ˆæ’ä¸€æ”¯æ——æ‰èƒ½å»ºè¨­ä¿è­·ç½©ï¼';
} else if (player.shields < 5) {
    player.shields++;
    actionText = 'ä½ å»ºäº†ä¸€å±¤ä¿è­·ç½©ï¼';
} else {
    actionText = 'ä¿è­·ç½©å·²é”ä¸Šé™ (5å±¤)ï¼';
}

document.getElementById('gameStatus').textContent = actionText;
updateUI();
resetTurn();
}


// ç©å®¶æ”»æ“Šæ•µäºº
function attackEnemy() {
if (gameState.currentPlayer !== 1 || gameState.gameOver || !canAttack(gameState.player1)) return;

const player2 = gameState.player2;
let attackTarget = '';
let actionText = '';

// è‡ªå‹•é¸æ“‡æ”»æ“Šç›®æ¨™ï¼šå„ªå…ˆé †åºï¼šä¿è­·ç½© > æ——å¹Ÿ > å¤§ç ² > å ¡å£˜
if (player2.shields > 0) {
    attackTarget = 'shields';
    player2.shields--;
    actionText = `ä½ æ”»æ“Šäº†é›»è…¦çš„ä¿è­·ç½©ï¼æ‘§æ¯€äº† 1 å±¤ï¼å‰©é¤˜${player2.shields}å±¤ï¼`;
} else if (player2.flags > 0) {
    attackTarget = 'flags';
    player2.flags--;
    actionText = `ä½ æ”»æ“Šäº†é›»è…¦çš„æ——å¹Ÿï¼æ‘§æ¯€äº† 1 æï¼å‰©é¤˜${player2.flags}æï¼`;
} else if (player2.cannons > 0) {
    attackTarget = 'cannons';
    player2.cannons--;
    actionText = `ä½ æ”»æ“Šäº†é›»è…¦çš„å¤§ç ²ï¼æ‘§æ¯€äº† 1 é–€ï¼å‰©é¤˜${player2.cannons}é–€ï¼`;
} else if (player2.fortressIntact) {
    attackTarget = 'fortress';
    player2.fortressIntact = false;
    document.getElementById('cell2-1').textContent = 'âŒ';
    document.getElementById('cell2-2').textContent = 'âŒ';
    document.getElementById('cell2-3').textContent = 'âŒ';
    document.getElementById('cell2-4').textContent = 'âŒ';
    actionText = 'ä½ æ‘§æ¯€äº†é›»è…¦çš„å ¡å£˜ï¼';
} else {
    actionText = 'é›»è…¦å·²ç¶“æ²’æœ‰ä»»ä½•è¨­æ–½å¯ä»¥æ”»æ“Šï¼';
}

document.getElementById('gameStatus').textContent = actionText;
updateUI();
checkGameOver();
resetTurn();
}



// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­æ——å¹Ÿ
function canBuildFlag(player) {
    return player.fortressIntact && player.flags < 3;
}

// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­å¤§ç‚®
function canBuildCannon(player) {
    return player.fortressIntact && player.flags > 0;
}

// æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­ä¿è­·ç½©
function canBuildShield(player) {
    return player.fortressIntact && player.flags > 0 && player.shields < 5;
}

// æª¢æŸ¥æ˜¯å¦å¯ä»¥æ”»æ“Š - æ–°è¦å‰‡ï¼š1 æ—— +1 ç ²
function canAttack(player) {
    return player.flags >= 1 && player.cannons >= 1;
}

// æª¢æŸ¥éšæ®µå‡ç´š - æ–°è¦å‰‡é¡¯ç¤º
function checkPhaseUpgrade(player, playerId) {
    const phaseIndicator = document.getElementById(`phase${playerId}`);
    if (player.flags >= 1 && player.cannons >= 1) {
        phaseIndicator.textContent = 'âš”ï¸ æ”»æ“Šå°±ç·’ (1æ——+1ç ²)';
        phaseIndicator.classList.add('attack-ready');
    } else if (player.flags >= 1) {
        phaseIndicator.textContent = 'ğŸ—ï¸ å»ºè¨­éšæ®µ (å¯å»ºä¿è­·ç½©/å¤§ç ²)';
        phaseIndicator.classList.remove('attack-ready');
    } else {
        phaseIndicator.textContent = 'ğŸš© åˆå§‹éšæ®µ (éœ€å…ˆæ’æ——)';
        phaseIndicator.classList.remove('attack-ready');
    }
}

// æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
function checkGameOver() {
const player1 = gameState.player1;
const player2 = gameState.player2;

// æ›´æ–°éšæ®µæç¤º
checkPhaseUpgrade(player1, 1);
checkPhaseUpgrade(player2, 2);

// æ–°è¼¸è´æ¢ä»¶ï¼šæ——=0 ä¸” ç½©=0 ä¸” å ¡å£˜æ¯€
if (player1.flags === 0 && player1.shields === 0 && !player1.fortressIntact) {
endGame(gameState.gameMode === 'ai' ? 'é›»è…¦è´äº†ï¼å¤©ä¸‹ä¸å¤ªå¹³ï¼' : 'ç©å®¶ 2 è´äº†ï¼');
return true;
}
if (player2.flags === 0 && player2.shields === 0 && !player2.fortressIntact) {
endGame(gameState.gameMode === 'ai' ? 'ä½ è´äº†ï¼å¤©ä¸‹å¤ªå¹³ï¼' : 'ç©å®¶ 1 è´äº†ï¼');
return true;
}
return false;
}

// çµæŸéŠæˆ²
function endGame(message) {
    gameState.gameOver = true;
    document.getElementById('resultDisplay').textContent = message;
    document.getElementById('gameStatus').textContent = 'éŠæˆ²çµæŸï¼';
    document.getElementById('gameStatus').style.backgroundColor = '#9b59b6';
    disableRPSButtons();
    disableActionButtons();
}

// é‡ç½®å›åˆ
function resetTurn() {
setTimeout(() => {
if (!gameState.gameOver) {
document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
enableRPSButtons();
disableActionButtons();
gameState.rpsResult = null;
}
}, 1500);
}

// æ›´æ–° UI
function updateUI() {
const p1 = gameState.player1;
const p2 = gameState.player2;
// æ›´æ–°ç©å®¶ 1 çš„ UI
document.getElementById('flags1').textContent = `${p1.flags}/3`;
document.getElementById('shields1').textContent = `${p1.shields}/5`;
document.getElementById('cannons1').textContent = p1.cannons;
// æ›´æ–°ç©å®¶ 2 çš„ UI
document.getElementById('flags2').textContent = `${p2.flags}/3`;
document.getElementById('shields2').textContent = `${p2.shields}/5`;
document.getElementById('cannons2').textContent = p2.cannons;

// æ›´æ–°è¡Œå‹•æŒ‰éˆ•ç‹€æ…‹
enableActionButtons();
}

// å•Ÿç”¨çŒœæ‹³æŒ‰éˆ•
function enableRPSButtons() {
document.querySelectorAll('.rps-btn').forEach(btn => {
btn.disabled = false;
btn.style.opacity = '1';
});
}
// åœç”¨çŒœæ‹³æŒ‰éˆ•
function disableRPSButtons() {
document.querySelectorAll('.rps-btn').forEach(btn => {
btn.disabled = true;
btn.style.opacity = '0.5';
});
}
// å•Ÿç”¨è¡Œå‹•æŒ‰éˆ•
function enableActionButtons() {
    const player = gameState.player1; // åªæœ‰ç©å®¶1å¯ä»¥è¡Œå‹•

    // å»ºè¨­æ——å¹ŸæŒ‰éˆ•
    const buildFlagBtn = document.getElementById('buildFlagBtn');
    buildFlagBtn.disabled = player.flags >= 3;
    buildFlagBtn.style.opacity = buildFlagBtn.disabled ? '0.5' : '1';
    buildFlagBtn.title = player.flags >= 3 ? "æ——å¹Ÿå·²é”ä¸Šé™ (3æ)" : "å»ºè¨­æ——å¹Ÿ";

    // å»ºè¨­å¤§ç‚®æŒ‰éˆ•
    const buildCannonBtn = document.getElementById('buildCannonBtn');
    buildCannonBtn.disabled = player.flags === 0;
    buildCannonBtn.style.opacity = buildCannonBtn.disabled ? '0.5' : '1';
    buildCannonBtn.title = player.flags === 0 ? "éœ€è¦å…ˆæ’ä¸€æ”¯æ——æ‰èƒ½å»ºè¨­å¤§ç‚®" : "å»ºè¨­å¤§ç‚®";

    // å»ºè¨­ä¿è­·ç½©æŒ‰éˆ•
    const buildShieldBtn = document.getElementById('buildShieldBtn');
    buildShieldBtn.disabled = player.flags === 0 || player.shields >= 5;
    buildShieldBtn.style.opacity = buildShieldBtn.disabled ? '0.5' : '1';
    buildShieldBtn.title = player.flags === 0 ? "éœ€è¦å…ˆæ’ä¸€æ”¯æ——æ‰èƒ½å»ºè¨­ä¿è­·ç½©" :
                          player.shields >= 5 ? "ä¿è­·ç½©å·²é”ä¸Šé™ (5å±¤)" : "å»ºè¨­ä¿è­·ç½©";

    // æ”»æ“ŠæŒ‰éˆ•
    const attackBtn = document.getElementById('attackBtn');
    attackBtn.disabled = !canAttack(player);
    attackBtn.style.opacity = attackBtn.disabled ? '0.5' : '1';
    attackBtn.title = !canAttack(player) ? `éœ€è¦ 1 æ—— +1 ç ²æ‰èƒ½æ”»æ“Š (ç›®å‰: ${player.flags}æ—— ${player.cannons}ç ²)` : "å¯ä»¥æ”»æ“Šæ•µäººï¼";

    // æŒ‰éˆ•æ–‡å­—ä¿æŒä¸è®Š
    buildFlagBtn.textContent = 'ğŸš© å»ºè¨­æ——å¹Ÿ';
    buildCannonBtn.textContent = 'ğŸ”« å»ºè¨­å¤§ç‚®';
    buildShieldBtn.textContent = 'ğŸ›¡ï¸ å»ºè¨­ä¿è­·ç½©';
    attackBtn.textContent = 'âš”ï¸ æ”»æ“Šæ•µäºº';
}
// åœç”¨è¡Œå‹•æŒ‰éˆ•
function disableActionButtons() {
document.querySelectorAll('.action-btn').forEach(btn => {
btn.disabled = true;
btn.style.opacity = '0.5';
});
}
// é‡ç½®éŠæˆ²
function resetGame() {
    if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹éŠæˆ²å—ï¼Ÿ')) {
        // å®Œå…¨é‡ç½®éŠæˆ²ç‹€æ…‹
        gameState.currentPlayer = 1;
        gameState.gameMode = 'ai';
        gameState.rpsResult = null;
        gameState.lastChoice = null;
        gameState.gameOver = false;
        gameState.player1 = {
            flags: 0,
            shields: 0,
            cannons: 0,
            fortressIntact: true,
        };
        gameState.player2 = {
            flags: 0,
            shields: 0,
            cannons: 0,
            fortressIntact: true,
        };
        
        // é‡ç½®UI
        document.getElementById('modeSelect').style.display = 'block';
        document.getElementById('rpsContainer').style.display = 'none';
        document.getElementById('actionContainer').style.display = 'none';
        document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡éŠæˆ²æ¨¡å¼é–‹å§‹...';
        document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
        document.getElementById('resultDisplay').textContent = '';
        
        // é‡ç½®ç©å®¶2æ¨™é¡Œ
        document.getElementById('player2Title').textContent = 'ğŸ¤– é›»è…¦';
        
        // é‡ç½®å ¡å£˜æ–‡å­—
        resetFortressText(1);
        resetFortressText(2);
        
        // æ›´æ–°UI
        updateUI();
        
        // å•Ÿç”¨çŒœæ‹³æŒ‰éˆ•
        enableRPSButtons();
        disableActionButtons();
    }
}
// æ¨¡æ…‹æ¡†ç³»çµ±
class ModalSystem {
constructor() {
this.overlay = document.getElementById('modalOverlay');
this.title = document.getElementById('modalTitle');
this.options = document.getElementById('modalOptions');
this.currentCallback = null;
}
show(title, options, callback) {
this.title.textContent = title;
this.options.innerHTML = '';
this.currentCallback = callback;
options.forEach(option => {
const button = document.createElement('button');
button.className = 'modal-option';
button.textContent = option.text;
button.value = option.value;
button.addEventListener('click', () => this.selectOption(option.value));
this.options.appendChild(button);
});
this.overlay.style.display = 'flex';
}
selectOption(value) {
this.hide();
if (this.currentCallback) {
this.currentCallback(value);
}
}
hide() {
this.overlay.style.display = 'none';
this.options.innerHTML = '';
this.currentCallback = null;
}
}
// åˆå§‹åŒ–æ¨¡æ…‹æ¡†
const modalSystem = new ModalSystem();
// æ›¿æ› prompt å‡½æ•¸
function showChoiceModal(title, choices, defaultValue = null) {
return new Promise((resolve) => {
const options = choices.map(choice => ({
text: choice.text || choice,
value: choice.value || choice
}));
modalSystem.show(title, options, (value) => {
resolve(value);
});
});
}
// åˆå§‹åŒ–éŠæˆ²
window.onload = initGame;
</script>
<!-- æ¨¡æ…‹æ¡† HTML -->
<div class="modal-overlay" id="modalOverlay">
<div class="modal-content">
<h3 class="modal-title" id="modalTitle">è«‹é¸æ“‡</h3>
<div class="modal-options" id="modalOptions">
<!-- é¸é …å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
</div>
</div>
</div>
</body>
</html>