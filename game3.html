<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©ä¸‹å¤ªå¹³ - é£›æ©Ÿå¤§ç ²éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            margin: 20px;
        }
        
        h1 {
            text-align: center;
            color: #e74c3c;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .game-info {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }
        
        .players-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .player-panel {
            flex: 1;
            min-width: 300px;
            background: #3498db;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .player-panel.player2 {
            background: #e74c3c;
        }
        
        .player-title {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .fortress {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .fortress-cell {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            height: 60px;
            min-height: 60px;
        }
        
        .player-panel.player2 .fortress-cell {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .facilities {
            margin: 15px 0;
        }
        
        .facility-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
        }
        
        .rock-paper-scissors {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }
        
        .rps-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .rps-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .rps-btn.rock { background: #ff9999; }
        .rps-btn.paper { background: #99ff99; }
        .rps-btn.scissors { background: #9999ff; }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .build-btn {
            background: #2ecc71;
            color: white;
        }
        
        .attack-btn {
            background: #e74c3c;
            color: white;
        }
        
        .repair-btn {
            background: #3498db;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .game-status {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
            padding: 15px;
            background: #f1c40f;
            border-radius: 10px;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .result-display {
            text-align: center;
            font-size: 2.5em;
            margin: 20px 0;
            font-weight: bold;
            color: #e74c3c;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            min-height: 60px;
        }
        
        .hidden {
            display: none;
        }
        
        .phase-indicator {
            text-align: center;
            font-size: 1.2em;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-weight: bold;
        }
        
        .phase-indicator.attack-ready {
            background: rgba(255, 215, 0, 0.3);
            border: 1px solid #ffc107;
        }
        
        .facility-highlight {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        
        @media (max-width: 768px) {
            .players-container {
                flex-direction: column;
            }
            
            .player-panel {
                min-width: 100%;
            }
            
            .rock-paper-scissors {
                flex-direction: column;
                align-items: center;
            }
            
            .rps-btn {
                width: 70px;
                height: 70px;
                margin: 5px 0;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ® å¤©ä¸‹å¤ªå¹³ - é£›æ©Ÿå¤§ç ² ğŸ®</h1>
        
        <div class="game-info">
            <p><strong>ç©æ³•èªªæ˜ï¼š</strong> é€™æ˜¯ä¸€å€‹åŸºæ–¼çŒœæ‹³çš„ç­–ç•¥éŠæˆ²ï¼</p>
            <p>1ï¸âƒ£ é€šéçŒœæ‹³æ±ºå®šå…ˆå¾Œé †åºï¼Œè´çš„ä¸€æ–¹å¯ä»¥å»ºè¨­æˆ–æ”»æ“Š</p>
            <p>2ï¸âƒ£ éŠæˆ²åˆ†å››å€‹éšæ®µï¼šå¯«ã€Œå¤©ä¸‹å¤ªå¹³ã€â†’ æ’æ—— â†’ å»ºä¿è­·ç½© â†’ æ”¾ç½®æ­¦å™¨/æ”»æ“Š</p>
            <p>3ï¸âƒ£ <span style="color: #e74c3c; font-weight: bold;">é‡è¦æ›´æ–°ï¼š</span> æ’æ——å¾Œï¼ˆè‡³å°‘ä¸€é¢æ——ï¼‰å³å¯æ”»æ“Šæ•µäººï¼</p>
            <p>4ï¸âƒ£ ç•¶ä¸€æ–¹çš„æ——ã€ä¿è­·ç½©å’Œå ¡å£˜å…¨éƒ¨è¢«æ¶ˆæ»…æ™‚ï¼Œè©²æ–¹è¼¸æ‰éŠæˆ²</p>
        </div>
        
        <div class="result-display" id="resultDisplay"></div>
        
        <div class="game-status" id="gameStatus">è«‹é¸æ“‡çŒœæ‹³...</div>
        
        <div class="players-container">
            <div class="player-panel player1">
                <div class="player-title">ğŸ‘¨ ç©å®¶1</div>
                <div class="phase-indicator" id="phase1">ç¬¬ä¸€éšæ®µï¼šå¯«ã€Œå¤©ä¸‹å¤ªå¹³ã€</div>
                <div class="fortress" id="fortress1">
                    <div class="fortress-cell" id="cell1-1">å¤©</div>
                    <div class="fortress-cell" id="cell1-2">ä¸‹</div>
                    <div class="fortress-cell" id="cell1-3">å¤ª</div>
                    <div class="fortress-cell" id="cell1-4">å¹³</div>
                </div>
                <div class="facilities">
                    <div class="facility-item facility-highlight" id="flagsItem1">
                        <span>ğŸš© æ——å¹Ÿï¼š</span>
                        <span id="flags1">0/3</span>
                    </div>
                    <div class="facility-item" id="shieldsItem1">
                        <span>ğŸ›¡ï¸ ä¿è­·ç½©ï¼š</span>
                        <span id="shields1">0/5</span>
                    </div>
                    <div class="facility-item">
                        <span>âœˆï¸ æˆ°æ©Ÿï¼š</span>
                        <span id="aircrafts1">0</span>
                    </div>
                    <div class="facility-item">
                        <span>ğŸ”« å¤§ç ²ï¼š</span>
                        <span id="cannons1">0</span>
                    </div>
                    <div class="facility-item">
                        <span>ğŸš€ ç«ç®­ï¼š</span>
                        <span id="rockets1">0</span>
                    </div>
                </div>
            </div>
            
            <div class="player-panel player2">
                <div class="player-title">ğŸ¤– é›»è…¦</div>
                <div class="phase-indicator" id="phase2">ç¬¬ä¸€éšæ®µï¼šå¯«ã€Œå¤©ä¸‹å¤ªå¹³ã€</div>
                <div class="fortress" id="fortress2">
                    <div class="fortress-cell" id="cell2-1">å¤©</div>
                    <div class="fortress-cell" id="cell2-2">ä¸‹</div>
                    <div class="fortress-cell" id="cell2-3">å¤ª</div>
                    <div class="fortress-cell" id="cell2-4">å¹³</div>
                </div>
                <div class="facilities">
                    <div class="facility-item facility-highlight" id="flagsItem2">
                        <span>ğŸš© æ——å¹Ÿï¼š</span>
                        <span id="flags2">0/3</span>
                    </div>
                    <div class="facility-item" id="shieldsItem2">
                        <span>ğŸ›¡ï¸ ä¿è­·ç½©ï¼š</span>
                        <span id="shields2">0/5</span>
                    </div>
                    <div class="facility-item">
                        <span>âœˆï¸ æˆ°æ©Ÿï¼š</span>
                        <span id="aircrafts2">0</span>
                    </div>
                    <div class="facility-item">
                        <span>ğŸ”« å¤§ç ²ï¼š</span>
                        <span id="cannons2">0</span>
                    </div>
                    <div class="facility-item">
                        <span>ğŸš€ ç«ç®­ï¼š</span>
                        <span id="rockets2">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="rock-paper-scissors">
            <button class="rps-btn rock" onclick="playerChoose('rock')">ğŸ‘Š çŸ³é ­</button>
            <button class="rps-btn paper" onclick="playerChoose('paper')">ğŸ–ï¸ å¸ƒ</button>
            <button class="rps-btn scissors" onclick="playerChoose('scissors')">âœŒï¸ å‰ªåˆ€</button>
        </div>
        
        <div class="game-controls">
            <button class="action-btn build-btn" onclick="buildFacility()" id="buildBtn">ğŸ—ï¸ å»ºè¨­è¨­æ–½</button>
            <button class="action-btn attack-btn" onclick="attackEnemy()" id="attackBtn">âš”ï¸ æ”»æ“Šæ•µäºº</button>
            <button class="action-btn repair-btn" onclick="repairFacility()" id="repairBtn">ğŸ”§ ä¿®å¾©è¨­æ–½</button>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="action-btn" style="background: #9b59b6; color: white;" onclick="resetGame()">ğŸ”„ é‡æ–°é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        const gameState = {
            currentPlayer: 1, // 1 = ç©å®¶1, 2 = é›»è…¦
            gamePhase: 1, // 1: å¯«å­—, 2: æ’æ——, 3: ä¿è­·ç½©, 4: æ­¦å™¨/æ”»æ“Š
            rpsResult: null, // 'win', 'lose', 'draw'
            lastChoice: null,
            player1: {
                flags: 0,
                shields: 0,
                aircrafts: 0,
                cannons: 0,
                rockets: 0,
                fortressIntact: true,
                phase: 1
            },
            player2: {
                flags: 0,
                shields: 0,
                aircrafts: 0,
                cannons: 0,
                rockets: 0,
                fortressIntact: true,
                phase: 1
            },
            gameOver: false
        };

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            gameState.currentPlayer = 1;
            gameState.gamePhase = 1;
            gameState.rpsResult = null;
            gameState.lastChoice = null;
            gameState.gameOver = false;
            
            gameState.player1 = {
                flags: 0,
                shields: 0,
                aircrafts: 0,
                cannons: 0,
                rockets: 0,
                fortressIntact: true,
                phase: 1
            };
            
            gameState.player2 = {
                flags: 0,
                shields: 0,
                aircrafts: 0,
                cannons: 0,
                rockets: 0,
                fortressIntact: true,
                phase: 1
            };
            
            // é‡ç½®UI
            document.getElementById('resultDisplay').textContent = '';
            document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
            document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
            
            // ç§»é™¤é«˜äº®æ•ˆæœ
            document.getElementById('flagsItem1').classList.remove('facility-highlight');
            document.getElementById('flagsItem2').classList.remove('facility-highlight');
            document.getElementById('shieldsItem1').classList.remove('facility-highlight');
            document.getElementById('shieldsItem2').classList.remove('facility-highlight');
            
            updateUI();
            enableRPSButtons();
            disableActionButtons();
        }

        // ç©å®¶é¸æ“‡çŒœæ‹³
        function playerChoose(choice) {
            if (gameState.gameOver) return;
            
            gameState.lastChoice = choice;
            const computerChoice = getComputerChoice();
            
            // é¡¯ç¤ºé¸æ“‡çµæœ
            document.getElementById('gameStatus').textContent = 
                `ä½ å‡º ${getChoiceName(choice)}ï¼Œé›»è…¦å‡º ${getChoiceName(computerChoice)}`;
            
            // è¨ˆç®—çµæœ
            gameState.rpsResult = calculateRPSResult(choice, computerChoice);
            
            if (gameState.rpsResult === 'win') {
                document.getElementById('gameStatus').textContent += ' - ä½ è´äº†ï¼å¯ä»¥è¡Œå‹•ï¼';
                document.getElementById('gameStatus').style.backgroundColor = '#2ecc71';
                gameState.currentPlayer = 1; // ç©å®¶1è´äº†ï¼Œç©å®¶1è¡Œå‹•
            } else if (gameState.rpsResult === 'lose') {
                document.getElementById('gameStatus').textContent += ' - ä½ è¼¸äº†ï¼é›»è…¦è¡Œå‹•ï¼';
                document.getElementById('gameStatus').style.backgroundColor = '#e74c3c';
                gameState.currentPlayer = 2; // ç©å®¶1è¼¸äº†ï¼Œé›»è…¦è¡Œå‹•
            } else {
                document.getElementById('gameStatus').textContent += ' - å¹³æ‰‹ï¼å†ä¾†ä¸€æ¬¡ï¼';
                document.getElementById('gameStatus').style.backgroundColor = '#f39c12';
                enableRPSButtons();
                disableActionButtons();
                return;
            }
            
            disableRPSButtons();
            enableActionButtons();
            
            // å¦‚æœæ˜¯é›»è…¦è¡Œå‹•ï¼Œè‡ªå‹•åŸ·è¡Œ
            if (gameState.currentPlayer === 2) {
                setTimeout(computerAction, 1000);
            }
        }

        // é›»è…¦é¸æ“‡çŒœæ‹³
        function getComputerChoice() {
            const choices = ['rock', 'paper', 'scissors'];
            return choices[Math.floor(Math.random() * 3)];
        }

        // è¨ˆç®—çŒœæ‹³çµæœ
        function calculateRPSResult(playerChoice, computerChoice) {
            if (playerChoice === computerChoice) {
                return 'draw';
            }
            
            if (
                (playerChoice === 'rock' && computerChoice === 'scissors') ||
                (playerChoice === 'paper' && computerChoice === 'rock') ||
                (playerChoice === 'scissors' && computerChoice === 'paper')
            ) {
                return 'win';
            }
            
            return 'lose';
        }

        // ç²å–é¸æ“‡çš„ä¸­æ–‡åç¨±
        function getChoiceName(choice) {
            const names = {
                'rock': 'çŸ³é ­',
                'paper': 'å¸ƒ',
                'scissors': 'å‰ªåˆ€'
            };
            return names[choice];
        }

        // é›»è…¦è‡ªå‹•è¡Œå‹•
        function computerAction() {
            if (gameState.gameOver) return;
            
            // é›»è…¦æ ¹æ“šéšæ®µå’Œè³‡æºæ±ºå®šè¡Œå‹•
            const player = gameState.player2;
            let actionTaken = false;
            
            // å„ªå…ˆå»ºè¨­åŸºç¤è¨­æ–½
            if (player.phase === 1 && player.flags < 3) {
                // æ’æ——éšæ®µ
                player.flags++;
                document.getElementById('gameStatus').textContent = 'é›»è…¦æ’äº†ä¸€ææ——ï¼';
                actionTaken = true;
            } else if (player.phase === 2 && player.shields < 5) {
                // ä¿è­·ç½©éšæ®µ
                player.shields++;
                document.getElementById('gameStatus').textContent = 'é›»è…¦å»ºäº†ä¸€å±¤ä¿è­·ç½©ï¼';
                actionTaken = true;
            } else if (canAttack()) {
                // å¯ä»¥æ”»æ“Šæ™‚å„ªå…ˆæ”»æ“Š
                computerAttack();
                actionTaken = true;
            } else if (player.phase === 2 || player.phase === 3) {
                // å»ºè¨­æ­¦å™¨
                const weapons = ['aircrafts', 'cannons', 'rockets'];
                const weapon = weapons[Math.floor(Math.random() * 3)];
                player[weapon]++;
                document.getElementById('gameStatus').textContent = `é›»è…¦å»ºé€ äº†${getWeaponName(weapon)}ï¼`;
                actionTaken = true;
            } else {
                // é»˜èªå»ºè¨­
                if (player.flags < 3) {
                    player.flags++;
                    document.getElementById('gameStatus').textContent = 'é›»è…¦æ’äº†ä¸€ææ——ï¼';
                } else if (player.shields < 5) {
                    player.shields++;
                    document.getElementById('gameStatus').textContent = 'é›»è…¦å»ºäº†ä¸€å±¤ä¿è­·ç½©ï¼';
                } else {
                    const weapons = ['aircrafts', 'cannons', 'rockets'];
                    const weapon = weapons[Math.floor(Math.random() * 3)];
                    player[weapon]++;
                    document.getElementById('gameStatus').textContent = `é›»è…¦å»ºé€ äº†${getWeaponName(weapon)}ï¼`;
                }
                actionTaken = true;
            }
            
            // æª¢æŸ¥æ˜¯å¦éœ€è¦é€²éš
            if (actionTaken) {
                checkPhaseUpgrade(player, 2);
                updateUI();
                checkGameOver();
            }
            
            // è¡Œå‹•å®Œæˆå¾Œï¼Œé‡æ–°å•Ÿç”¨çŒœæ‹³æŒ‰éˆ•
            setTimeout(() => {
                if (!gameState.gameOver) {
                    document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
                    document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
                    enableRPSButtons();
                    disableActionButtons();
                }
            }, 1500);
        }

        // é›»è…¦æ”»æ“Š
        function computerAttack() {
            const player1 = gameState.player1;
            const attackPower = getAttackPower(gameState.player2);
            
            // é¸æ“‡æ”»æ“Šç›®æ¨™ï¼ˆå„ªå…ˆæ”»æ“Šä¿è­·ç½©ï¼Œç„¶å¾Œæ˜¯æ——å¹Ÿï¼Œæœ€å¾Œæ˜¯å ¡å£˜ï¼‰
            let target = '';
            if (player1.shields > 0) {
                target = 'shields';
            } else if (player1.flags > 0) {
                target = 'flags';
            } else if (player1.fortressIntact) {
                target = 'fortress';
            }
            
            if (!target) return; // æ²’æœ‰å¯æ”»æ“Šç›®æ¨™
            
            if (target === 'shields') {
                const damage = Math.min(attackPower, player1.shields);
                player1.shields -= damage;
                document.getElementById('gameStatus').textContent = `é›»è…¦æ”»æ“Šäº†ä½ çš„ä¿è­·ç½©ï¼é€ æˆäº†${damage}é»å‚·å®³ï¼å‰©é¤˜${player1.shields}å±¤ï¼`;
            } else if (target === 'flags') {
                const damage = Math.min(attackPower, player1.flags);
                player1.flags -= damage;
                document.getElementById('gameStatus').textContent = `é›»è…¦æ”»æ“Šäº†ä½ çš„æ——å¹Ÿï¼é€ æˆäº†${damage}é»å‚·å®³ï¼å‰©é¤˜${player1.flags}æï¼`;
            } else if (target === 'fortress') {
                player1.fortressIntact = false;
                // æ¸…ç©ºå ¡å£˜æ–‡å­—
                document.getElementById('cell1-1').textContent = '';
                document.getElementById('cell1-2').textContent = '';
                document.getElementById('cell1-3').textContent = '';
                document.getElementById('cell1-4').textContent = '';
                document.getElementById('gameStatus').textContent = 'é›»è…¦æ‘§æ¯€äº†ä½ çš„å ¡å£˜ï¼';
            }
        }

        // ç©å®¶å»ºè¨­è¨­æ–½
        function buildFacility() {
            if (gameState.currentPlayer !== 1 || gameState.gameOver) return;
            
            const player = gameState.player1;
            let actionText = '';
            
            switch(player.phase) {
                case 1: // æ’æ——
                    if (player.flags < 3) {
                        player.flags++;
                        actionText = 'ä½ æ’äº†ä¸€ææ——ï¼';
                        // ç•¶ç¬¬ä¸€é¢æ——æ’ä¸‹æ™‚ï¼Œæç¤ºå¯ä»¥æ”»æ“Š
                        if (player.flags === 1) {
                            document.getElementById('flagsItem1').classList.add('facility-highlight');
                            setTimeout(() => {
                                document.getElementById('flagsItem1').classList.remove('facility-highlight');
                            }, 3000);
                        }
                    } else {
                        actionText = 'æ——å¹Ÿå·²é”ä¸Šé™ï¼';
                    }
                    break;
                case 2: // ä¿è­·ç½©
                    if (player.shields < 5) {
                        player.shields++;
                        actionText = 'ä½ å»ºäº†ä¸€å±¤ä¿è­·ç½©ï¼';
                    } else {
                        actionText = 'ä¿è­·ç½©å·²é”ä¸Šé™ï¼';
                    }
                    break;
                case 3: // æ­¦å™¨
                    // è®“ç©å®¶é¸æ“‡å»ºè¨­å“ªç¨®æ­¦å™¨
                    const weaponChoice = prompt("é¸æ“‡è¦å»ºè¨­çš„æ­¦å™¨:\n1. æˆ°æ©Ÿ (æ”»æ“ŠåŠ›1)\n2. å¤§ç ² (æ”»æ“ŠåŠ›2)\n3. ç«ç®­ (æ”»æ“ŠåŠ›3)", "1");
                    let weaponType = '';
                    
                    if (weaponChoice === "1") {
                        player.aircrafts++;
                        weaponType = 'aircrafts';
                    } else if (weaponChoice === "2") {
                        player.cannons++;
                        weaponType = 'cannons';
                    } else if (weaponChoice === "3") {
                        player.rockets++;
                        weaponType = 'rockets';
                    } else {
                        actionText = 'ç„¡æ•ˆé¸æ“‡ï¼Œæœªå»ºè¨­æ­¦å™¨ã€‚';
                        break;
                    }
                    
                    actionText = `ä½ å»ºé€ äº†${getWeaponName(weaponType)}ï¼`;
                    break;
            }
            
            document.getElementById('gameStatus').textContent = actionText || 'å»ºè¨­å®Œæˆï¼';
            
            // æª¢æŸ¥æ˜¯å¦éœ€è¦é€²éš
            checkPhaseUpgrade(player, 1);
            updateUI();
            
            // é‡ç½®çŒœæ‹³ç‹€æ…‹
            resetTurn();
        }

        // ç©å®¶æ”»æ“Šæ•µäºº - æ ¸å¿ƒä¿®æ”¹ï¼šå…è¨±åœ¨æ’æ——å¾Œï¼ˆç¬¬äºŒéšæ®µï¼‰æ”»æ“Š
        function attackEnemy() {
            if (gameState.currentPlayer !== 1 || gameState.gameOver || !canAttack()) return;
            
            const player2 = gameState.player2;
            const attackPower = getAttackPower(gameState.player1);
            
            // é¸æ“‡æ”»æ“Šç›®æ¨™
            const target = prompt("é¸æ“‡æ”»æ“Šç›®æ¨™:\n1. ä¿è­·ç½©\n2. æ——å¹Ÿ\n3. å ¡å£˜", "1");
            let attackTarget = '';
            
            if (target === "1" && player2.shields > 0) {
                attackTarget = 'shields';
            } else if (target === "2" && player2.flags > 0) {
                attackTarget = 'flags';
            } else if (target === "3" && player2.fortressIntact) {
                attackTarget = 'fortress';
            } else {
                // è‡ªå‹•é¸æ“‡æœ‰æ•ˆç›®æ¨™
                if (player2.shields > 0) attackTarget = 'shields';
                else if (player2.flags > 0) attackTarget = 'flags';
                else if (player2.fortressIntact) attackTarget = 'fortress';
                else {
                    document.getElementById('gameStatus').textContent = 'æ²’æœ‰å¯æ”»æ“Šçš„ç›®æ¨™ï¼';
                    return;
                }
            }
            
            if (attackTarget === 'shields') {
                const damage = Math.min(attackPower, player2.shields);
                player2.shields -= damage;
                document.getElementById('gameStatus').textContent = `ä½ æ”»æ“Šäº†é›»è…¦çš„ä¿è­·ç½©ï¼é€ æˆäº†${damage}é»å‚·å®³ï¼å‰©é¤˜${player2.shields}å±¤ï¼`;
            } else if (attackTarget === 'flags') {
                const damage = Math.min(attackPower, player2.flags);
                player2.flags -= damage;
                document.getElementById('gameStatus').textContent = `ä½ æ”»æ“Šäº†é›»è…¦çš„æ——å¹Ÿï¼é€ æˆäº†${damage}é»å‚·å®³ï¼å‰©é¤˜${player2.flags}æï¼`;
            } else if (attackTarget === 'fortress') {
                player2.fortressIntact = false;
                // æ¸…ç©ºå ¡å£˜æ–‡å­—
                document.getElementById('cell2-1').textContent = '';
                document.getElementById('cell2-2').textContent = '';
                document.getElementById('cell2-3').textContent = '';
                document.getElementById('cell2-4').textContent = '';
                document.getElementById('gameStatus').textContent = 'ä½ æ‘§æ¯€äº†é›»è…¦çš„å ¡å£˜ï¼';
            }
            
            updateUI();
            checkGameOver();
            
            // é‡ç½®çŒœæ‹³ç‹€æ…‹
            resetTurn();
        }

        // ç©å®¶ä¿®å¾©è¨­æ–½
        function repairFacility() {
            if (gameState.currentPlayer !== 1 || gameState.gameOver || !canRepair(gameState.player1)) return;
            
            const player = gameState.player1;
            let actionText = '';
            
            // è®“ç©å®¶é¸æ“‡ä¿®å¾©ä»€éº¼
            const repairChoice = prompt("é¸æ“‡ä¿®å¾©é …ç›®:\n1. æ——å¹Ÿ (æ¯æ1é»è³‡æº)\n2. ä¿è­·ç½© (æ¯å±¤1é»è³‡æº)\n3. å ¡å£˜ (éœ€è¦3é»è³‡æº)", "1");
            
            if (repairChoice === "1" && player.flags < 3) {
                player.flags = Math.min(3, player.flags + 1);
                actionText = 'ä½ ä¿®å¾©äº†ä¸€ææ——å¹Ÿï¼';
            } else if (repairChoice === "2" && player.shields < 5) {
                player.shields = Math.min(5, player.shields + 1);
                actionText = 'ä½ ä¿®å¾©äº†ä¸€å±¤ä¿è­·ç½©ï¼';
            } else if (repairChoice === "3" && !player.fortressIntact) {
                // ä¿®å¾©å ¡å£˜éœ€è¦è³‡æºï¼Œæ­¤è™•ç°¡åŒ–
                player.fortressIntact = true;
                document.getElementById('cell1-1').textContent = 'å¤©';
                document.getElementById('cell1-2').textContent = 'ä¸‹';
                document.getElementById('cell1-3').textContent = 'å¤ª';
                document.getElementById('cell1-4').textContent = 'å¹³';
                actionText = 'ä½ ä¿®å¾©äº†å ¡å£˜ï¼';
            } else {
                actionText = 'ç„¡æ•ˆé¸æ“‡æˆ–è³‡æºä¸è¶³ã€‚';
            }
            
            document.getElementById('gameStatus').textContent = actionText;
            updateUI();
            
            // é‡ç½®çŒœæ‹³ç‹€æ…‹
            resetTurn();
        }

        // ç²å–æ­¦å™¨åç¨±
        function getWeaponName(weaponType) {
            const names = {
                'aircrafts': 'æˆ°æ©Ÿ',
                'cannons': 'å¤§ç ²',
                'rockets': 'ç«ç®­'
            };
            return names[weaponType];
        }

        // æª¢æŸ¥æ˜¯å¦å¯ä»¥å»ºè¨­
        function canBuild(player) {
            if (!player.fortressIntact) return false;
            
            switch(player.phase) {
                case 1: return player.flags < 3;
                case 2: return player.shields < 5;
                case 3: return true; // æ­¦å™¨å¯ä»¥ç„¡é™å»ºé€ 
                default: return false;
            }
        }

        // æª¢æŸ¥æ˜¯å¦å¯ä»¥æ”»æ“Š - é—œéµä¿®æ”¹ï¼šå…è¨±åœ¨ç¬¬äºŒéšæ®µï¼ˆä¿è­·ç½©éšæ®µï¼‰ä¸”æœ‰æ——å¹Ÿæ™‚æ”»æ“Š
        function canAttack() {
            const attacker = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            
            // ç¬¬ä¸€éšæ®µï¼ˆæ’æ——éšæ®µï¼‰ä¸èƒ½æ”»æ“Š
            if (attacker.phase === 1) return false;
            
            // ç¬¬äºŒéšæ®µï¼ˆä¿è­·ç½©éšæ®µï¼‰ï¼šåªè¦æœ‰æ——å¹Ÿå°±å¯ä»¥æ”»æ“Š
            if (attacker.phase === 2) {
                return attacker.flags > 0;
            }
            
            // ç¬¬ä¸‰éšæ®µï¼ˆæ­¦å™¨éšæ®µï¼‰ï¼šéœ€è¦æœ‰æ­¦å™¨
            if (attacker.phase === 3) {
                return attacker.aircrafts > 0 || attacker.cannons > 0 || attacker.rockets > 0;
            }
            
            return false;
        }

        // æª¢æŸ¥æ˜¯å¦å¯ä»¥ä¿®å¾©
        function canRepair(player) {
            return !player.fortressIntact || player.shields < 5 || player.flags < 3;
        }

        // ç²å–æ”»æ“ŠåŠ› - é—œéµä¿®æ”¹ï¼šæ ¹æ“šéšæ®µå’Œè¨­æ–½è¨ˆç®—æ”»æ“ŠåŠ›
        function getAttackPower(player) {
            if (player.phase === 2) {
                // ä¿è­·ç½©éšæ®µï¼šæ”»æ“ŠåŠ› = æ——å¹Ÿæ•¸é‡
                return player.flags;
            } else if (player.phase === 3) {
                // æ­¦å™¨éšæ®µï¼šæ”»æ“ŠåŠ› = æ­¦å™¨ç¸½æ”»æ“ŠåŠ›
                // æˆ°æ©Ÿ:1, å¤§ç ²:2, ç«ç®­:3
                return player.aircrafts * 1 + player.cannons * 2 + player.rockets * 3;
            }
            return 0;
        }

        // æª¢æŸ¥éšæ®µå‡ç´š
        function checkPhaseUpgrade(player, playerId) {
            const phaseIndicator = document.getElementById(`phase${playerId}`);
            
            switch(player.phase) {
                case 1: // æ’æ——éšæ®µ
                    if (player.flags >= 3) {
                        player.phase = 2;
                        phaseIndicator.textContent = 'ç¬¬äºŒéšæ®µï¼šå»ºç«‹ä¿è­·ç½© (æ’æ——å¾Œå¯æ”»æ“Š)';
                        phaseIndicator.classList.add('attack-ready');
                        // é«˜äº®ä¿è­·ç½©é …ç›®
                        if (playerId === 1) {
                            document.getElementById('shieldsItem1').classList.add('facility-highlight');
                        } else {
                            document.getElementById('shieldsItem2').classList.add('facility-highlight');
                        }
                    }
                    break;
                case 2: // ä¿è­·ç½©éšæ®µ
                    if (player.shields >= 5) {
                        player.phase = 3;
                        phaseIndicator.textContent = 'ç¬¬ä¸‰éšæ®µï¼šæ­¦å™¨/æ”»æ“Š (é«˜æ”»æ“ŠåŠ›)';
                        phaseIndicator.classList.remove('attack-ready');
                        phaseIndicator.classList.add('attack-ready');
                    }
                    break;
            }
        }

        // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
        function checkGameOver() {
            const player1 = gameState.player1;
            const player2 = gameState.player2;
            
            // æª¢æŸ¥ç©å®¶1æ˜¯å¦è¼¸äº†
            if (player1.flags === 0 && player1.shields === 0 && !player1.fortressIntact) {
                endGame('é›»è…¦è´äº†ï¼å¤©ä¸‹ä¸å¤ªå¹³ï¼');
                return true;
            }
            
            // æª¢æŸ¥ç©å®¶2æ˜¯å¦è¼¸äº†
            if (player2.flags === 0 && player2.shields === 0 && !player2.fortressIntact) {
                endGame('ä½ è´äº†ï¼å¤©ä¸‹å¤ªå¹³ï¼');
                return true;
            }
            
            return false;
        }

        // çµæŸéŠæˆ²
        function endGame(message) {
            gameState.gameOver = true;
            document.getElementById('resultDisplay').textContent = message;
            document.getElementById('gameStatus').textContent = 'éŠæˆ²çµæŸï¼';
            disableRPSButtons();
            disableActionButtons();
        }

        // é‡ç½®å›åˆ
        function resetTurn() {
            setTimeout(() => {
                if (!gameState.gameOver) {
                    document.getElementById('gameStatus').textContent = 'è«‹é¸æ“‡çŒœæ‹³...';
                    document.getElementById('gameStatus').style.backgroundColor = '#f1c40f';
                    enableRPSButtons();
                    disableActionButtons();
                    gameState.rpsResult = null;
                }
            }, 1500);
        }

        // æ›´æ–°UI
        function updateUI() {
            const p1 = gameState.player1;
            const p2 = gameState.player2;
            
            // æ›´æ–°ç©å®¶1çš„UI
            document.getElementById('flags1').textContent = `${p1.flags}/3`;
            document.getElementById('shields1').textContent = `${p1.shields}/5`;
            document.getElementById('aircrafts1').textContent = p1.aircrafts;
            document.getElementById('cannons1').textContent = p1.cannons;
            document.getElementById('rockets1').textContent = p1.rockets;
            
            // æ›´æ–°ç©å®¶2çš„UI
            document.getElementById('flags2').textContent = `${p2.flags}/3`;
            document.getElementById('shields2').textContent = `${p2.shields}/5`;
            document.getElementById('aircrafts2').textContent = p2.aircrafts;
            document.getElementById('cannons2').textContent = p2.cannons;
            document.getElementById('rockets2').textContent = p2.rockets;
            
            // æ›´æ–°å ¡å£˜é¡¯ç¤º
            if (!p1.fortressIntact) {
                document.getElementById('cell1-1').textContent = 'âŒ';
                document.getElementById('cell1-2').textContent = 'âŒ';
                document.getElementById('cell1-3').textContent = 'âŒ';
                document.getElementById('cell1-4').textContent = 'âŒ';
            }
            
            if (!p2.fortressIntact) {
                document.getElementById('cell2-1').textContent = 'âŒ';
                document.getElementById('cell2-2').textContent = 'âŒ';
                document.getElementById('cell2-3').textContent = 'âŒ';
                document.getElementById('cell2-4').textContent = 'âŒ';
            }
            
            // æ›´æ–°è¡Œå‹•æŒ‰éˆ•ç‹€æ…‹
            enableActionButtons();
        }

        // å•Ÿç”¨çŒœæ‹³æŒ‰éˆ•
        function enableRPSButtons() {
            document.querySelectorAll('.rps-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
            });
        }

        // åœç”¨çŒœæ‹³æŒ‰éˆ•
        function disableRPSButtons() {
            document.querySelectorAll('.rps-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
        }

        // å•Ÿç”¨è¡Œå‹•æŒ‰éˆ•
        function enableActionButtons() {
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            
            // å»ºè¨­æŒ‰éˆ•ï¼šåªè¦å¯ä»¥å»ºè¨­å°±å•Ÿç”¨
            const buildBtn = document.getElementById('buildBtn');
            buildBtn.disabled = !canBuild(player);
            buildBtn.style.opacity = buildBtn.disabled ? '0.5' : '1';
            buildBtn.title = !canBuild(player) ? "ç„¡æ³•å»ºè¨­ï¼šå·²å®Œæˆæœ¬éšæ®µæˆ–å ¡å£˜å·²æ¯€" : "";
            
            // æ”»æ“ŠæŒ‰éˆ•ï¼šæ ¹æ“šæ–°è¦å‰‡å•Ÿç”¨
            const attackBtn = document.getElementById('attackBtn');
            attackBtn.disabled = !canAttack();
            attackBtn.style.opacity = attackBtn.disabled ? '0.5' : '1';
            attackBtn.title = !canAttack() ? getAttackDisabledReason(player) : "å¯ä»¥æ”»æ“Šæ•µäººï¼";
            
            // ä¿®å¾©æŒ‰éˆ•
            const repairBtn = document.getElementById('repairBtn');
            repairBtn.disabled = !canRepair(player);
            repairBtn.style.opacity = repairBtn.disabled ? '0.5' : '1';
            repairBtn.title = !canRepair(player) ? "ç„¡éœ€ä¿®å¾©" : "";
        }

        // ç²å–æ”»æ“ŠæŒ‰éˆ•ç¦ç”¨åŸå› 
        function getAttackDisabledReason(player) {
            if (player.phase === 1) {
                return "éœ€è¦å…ˆå®Œæˆæ’æ——éšæ®µ";
            } else if (player.phase === 2 && player.flags === 0) {
                return "éœ€è¦è‡³å°‘ä¸€é¢æ——å¹Ÿæ‰èƒ½æ”»æ“Š";
            } else if (player.phase === 3 && 
                      player.aircrafts === 0 && 
                      player.cannons === 0 && 
                      player.rockets === 0) {
                return "éœ€è¦å…ˆå»ºé€ æ­¦å™¨";
            }
            return "ç„¡æ³•æ”»æ“Š";
        }

        // åœç”¨è¡Œå‹•æŒ‰éˆ•
        function disableActionButtons() {
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹éŠæˆ²å—ï¼Ÿ')) {
                initGame();
            }
        }

        // åˆå§‹åŒ–éŠæˆ²
        window.onload = initGame;
    </script>
</body>
</html>